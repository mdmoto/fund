<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–µä¹å•†åŸ - å®æ—¶æ•°æ®</title>
    <link rel="icon" href="https://pub-52cfa058efcc498eb28c64d7af72cf06.r2.dev/logo.png">
    <link rel="apple-touch-icon" href="https://pub-52cfa058efcc498eb28c64d7af72cf06.r2.dev/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }
        .animate-pulse-slow {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .animate-slide-up {
            animation: slideUp 0.6s ease-out forwards;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .number-value {
            font-variant-numeric: tabular-nums;
        }
        .gradient-border {
            position: relative;
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(135deg, #f59e0b, #ef4444, #ec4899) border-box;
            border: 2px solid transparent;
        }
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .stat-card {
                padding: 1rem !important;
            }
            .number-value {
                font-size: 1.5rem !important;
            }
            h1 {
                font-size: 1.5rem !important;
            }
            h2 {
                font-size: 1.25rem !important;
            }
            .mini-card .number-value {
                font-size: 1.25rem !important;
            }
        }
        /* è¡¨æ ¼ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 640px) {
            table {
                font-size: 0.875rem;
            }
            td, th {
                padding: 0.5rem 0.25rem !important;
            }
            .font-mono {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-amber-50 via-orange-50 to-red-50 min-h-screen">
    <div class="container mx-auto px-3 sm:px-4 py-4 sm:py-8 max-w-7xl">
        <!-- Header -->
        <header class="mb-6 sm:mb-8 text-center animate-slide-up">
            <div class="flex flex-col sm:flex-row items-center justify-center gap-3 mb-3 sm:mb-4">
                <img src="https://pub-52cfa058efcc498eb28c64d7af72cf06.r2.dev/logo.png" 
                     alt="Maollar logo" 
                     class="h-12 w-12 sm:h-16 sm:w-16 rounded-full border-2 border-amber-400 shadow-lg">
                <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900" data-i18n="title">å–µä¹å•†åŸå®æ—¶æ•°æ®</h1>
            </div>
            <div class="flex items-center justify-center gap-2 text-sm sm:text-base text-gray-600">
                <span class="inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                <span data-i18n="subtitle">å®æ—¶æ›´æ–° Â· æ•°æ®é€æ˜</span>
            </div>
        </header>

        <!-- å•†åŸç»Ÿè®¡æ•°æ® -->
        <section class="mb-6 sm:mb-8 animate-slide-up" style="animation-delay: 0.1s; opacity: 0;">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-3 sm:mb-4 flex items-center gap-2 px-1">
                <span class="text-2xl">ğŸ“Š</span> 
                <span data-i18n="section.stats">å•†åŸç»Ÿè®¡</span>
            </h2>
            
            <!-- æ¡£ä½ä¿¡æ¯ - ç§»åŠ¨ç«¯2åˆ—ï¼Œå¤§å±4åˆ— -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-3 sm:mb-4" id="tierStats">
                <div class="stat-card rounded-xl p-4 sm:p-6 shadow-lg">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xl">ğŸ¯</span>
                        <div class="text-xs sm:text-sm text-gray-600" data-i18n="label.currentTier">å½“å‰æ¡£ä½</div>
                    </div>
                    <div class="text-2xl sm:text-3xl font-bold text-amber-600 number-value" id="currentTier">
                        <span class="animate-pulse-slow">...</span>
                    </div>
                </div>
                <div class="stat-card rounded-xl p-4 sm:p-6 shadow-lg">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xl">ğŸ’°</span>
                        <div class="text-xs sm:text-sm text-gray-600" data-i18n="label.coinsPerUsd">æ¯$1è·å¾—</div>
                    </div>
                    <div class="text-2xl sm:text-3xl font-bold text-blue-600 number-value" id="coinsPerUsd">
                        <span class="animate-pulse-slow">...</span>
                    </div>
                </div>
                <div class="stat-card rounded-xl p-4 sm:p-6 shadow-lg">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xl">ğŸ’</span>
                        <div class="text-xs sm:text-sm text-gray-600" data-i18n="label.intrinsicPrice">å–µå¸ä»·æ ¼</div>
                    </div>
                    <div class="text-2xl sm:text-3xl font-bold text-green-600 number-value" id="intrinsicPrice">
                        <span class="animate-pulse-slow">...</span>
                    </div>
                </div>
                <div class="stat-card rounded-xl p-4 sm:p-6 shadow-lg">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xl">ğŸ“ˆ</span>
                        <div class="text-xs sm:text-sm text-gray-600" data-i18n="label.premium">å¸‚åœºæº¢ä»·</div>
                    </div>
                    <div class="text-2xl sm:text-3xl font-bold text-purple-600 number-value" id="secondaryPremium">
                        <span class="animate-pulse-slow">...</span>
                    </div>
                </div>
            </div>
            
            <!-- é”€å”®ä¸åŸºé‡‘ - ç§»åŠ¨ç«¯1åˆ—ï¼Œå¤§å±2åˆ— -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                <div class="stat-card gradient-border rounded-xl p-4 sm:p-6 shadow-lg">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">ğŸª</span>
                            <div class="text-sm sm:text-base text-gray-600 font-semibold" data-i18n="label.totalSales">æ€»é”€å”®é¢</div>
                        </div>
                    </div>
                    <div class="text-2xl sm:text-3xl font-bold text-orange-600 number-value" id="totalSalesValue">
                        <span class="animate-pulse-slow">åŠ è½½ä¸­...</span>
                    </div>
                </div>
                <div class="stat-card gradient-border rounded-xl p-4 sm:p-6 shadow-lg">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">ğŸ¦</span>
                            <div class="text-sm sm:text-base text-gray-600 font-semibold" data-i18n="label.fundPool">åŸºé‡‘æ± æ€»é‡‘é¢</div>
                        </div>
                    </div>
                    <div class="text-2xl sm:text-3xl font-bold text-red-600 number-value" id="fundPoolValue">
                        <span class="animate-pulse-slow">åŠ è½½ä¸­...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- å–µå¸ä¿¡æ¯ -->
        <section class="mb-6 sm:mb-8 animate-slide-up" style="animation-delay: 0.2s; opacity: 0;">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-3 sm:mb-4 flex items-center gap-2 px-1">
                <img src="https://pub-52cfa058efcc498eb28c64d7af72cf06.r2.dev/logo.png" alt="MEOW logo" class="w-6 h-6 sm:w-8 sm:h-8 rounded-full border border-amber-300 shadow" />
                <span data-i18n="section.meow">å–µå¸ (MEOW)</span>
            </h2>
            
            <!-- ä»£å¸ä¿¡æ¯å¡ç‰‡ -->
            <div class="stat-card rounded-xl p-4 sm:p-6 shadow-lg mb-3 sm:mb-4">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4 pb-4 border-b border-gray-200">
                    <div class="flex-1 min-w-0">
                        <div class="text-xs sm:text-sm text-gray-600 mb-1" data-i18n="label.tokenAddress">ä»£å¸åœ°å€</div>
                        <div class="text-xs sm:text-sm font-mono text-gray-800 break-all" id="tokenAddress">
                            9zFnwrEyyNPVgahM5NL4MpUH7iy7L8qNCqRprzj39m9N
                        </div>
                    </div>
                    <a href="https://solscan.io/token/9zFnwrEyyNPVgahM5NL4MpUH7iy7L8qNCqRprzj39m9N" 
                       target="_blank" 
                       rel="noopener noreferrer"
                       class="flex items-center justify-center gap-1 px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-sm rounded-lg hover:from-blue-600 hover:to-blue-700 transition shadow-md whitespace-nowrap">
                        <span data-i18n="action.view">æŸ¥çœ‹è¯¦æƒ…</span>
                        <span>â†—</span>
                    </a>
                </div>
                
                <!-- å¸‚åœºæ•°æ® - ç§»åŠ¨ç«¯1åˆ—ï¼Œå¤§å±3åˆ— -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-4">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-lg">ğŸ“¦</span>
                            <div class="text-xs sm:text-sm text-gray-600" data-i18n="label.totalSupply">æ€»ä¾›åº”é‡</div>
                        </div>
                        <div class="text-lg sm:text-xl font-bold text-gray-900 number-value" id="totalSupply">
                            <span class="animate-pulse-slow">åŠ è½½ä¸­...</span>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-green-50 to-emerald-100 rounded-lg p-4">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-lg">ğŸ’µ</span>
                            <div class="text-xs sm:text-sm text-gray-600" data-i18n="label.marketPrice">äºŒçº§å¸‚åœºä»·æ ¼</div>
                        </div>
                        <div class="text-lg sm:text-xl font-bold text-green-700 number-value" id="tokenPrice">
                            <span class="animate-pulse-slow">æŸ¥è¯¢ä¸­...</span>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-100 rounded-lg p-4">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-lg">ğŸ“Š</span>
                            <div class="text-xs sm:text-sm text-gray-600" data-i18n="label.volume24h">24häº¤æ˜“é‡</div>
                        </div>
                        <div class="text-lg sm:text-xl font-bold text-blue-700 number-value" id="volume24h">
                            <span class="animate-pulse-slow">æŸ¥è¯¢ä¸­...</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- æŒä»“æ’è¡Œæ¦œ -->
        <section class="mb-6 sm:mb-8 animate-slide-up" style="animation-delay: 0.3s; opacity: 0;">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-3 sm:mb-4 flex items-center gap-2 px-1">
                <span class="text-2xl">ğŸ†</span> 
                <span data-i18n="section.holders">æŒä»“æ’è¡Œæ¦œ</span>
            </h2>
            <div class="stat-card rounded-xl shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm sm:text-base">
                        <thead class="bg-gradient-to-r from-amber-500 to-orange-500 text-white">
                            <tr>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs sm:text-sm" data-i18n="table.rank">æ’å</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs sm:text-sm" data-i18n="table.address">åœ°å€</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-right text-xs sm:text-sm" data-i18n="table.amount">æŒä»“é‡</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-right text-xs sm:text-sm" data-i18n="table.share">å æ¯”</th>
                            </tr>
                        </thead>
                        <tbody id="holdersTable" class="divide-y divide-gray-200 bg-white">
                            <tr>
                                <td colspan="4" class="px-4 py-8 text-center text-gray-500">
                                    <span class="animate-pulse-slow">åŠ è½½ä¸­...</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- æœ€è¿‘äº¤æ˜“ -->
        <section class="mb-20 sm:mb-8 animate-slide-up" style="animation-delay: 0.4s; opacity: 0;">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-3 sm:mb-4 flex items-center gap-2 px-1">
                <span class="text-2xl">ğŸ“ˆ</span> 
                <span data-i18n="section.trades">æœ€è¿‘äº¤æ˜“</span>
            </h2>
            <div class="stat-card rounded-xl shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm sm:text-base">
                        <thead class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white">
                            <tr>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs sm:text-sm" data-i18n="table.time">æ—¶é—´</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs sm:text-sm" data-i18n="table.type">ç±»å‹</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-right text-xs sm:text-sm" data-i18n="table.qty">æ•°é‡</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-right text-xs sm:text-sm" data-i18n="table.price">ä»·æ ¼</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs sm:text-sm hidden sm:table-cell" data-i18n="table.txhash">äº¤æ˜“å“ˆå¸Œ</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsTable" class="divide-y divide-gray-200 bg-white">
                            <tr>
                                <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                                    <span class="animate-pulse-slow">åŠ è½½ä¸­...</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- åˆ·æ–°æŒ‰é’® - ç§»åŠ¨ç«¯ä¼˜åŒ– -->
        <div class="fixed bottom-4 right-4 sm:bottom-8 sm:right-8 z-50">
            <button onclick="loadAllData()" 
                    class="flex items-center gap-2 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-bold py-2 px-4 sm:py-3 sm:px-6 rounded-full shadow-2xl transition transform hover:scale-105 active:scale-95">
                <span class="text-lg sm:text-xl">ğŸ”„</span>
                <span class="text-sm sm:text-base" data-i18n="action.refresh">åˆ·æ–°</span>
            </button>
        </div>
        
        <!-- é¡µè„š -->
        <footer class="mt-12 pb-20 sm:pb-8 text-center animate-slide-up" style="animation-delay: 0.5s; opacity: 0;">
            <div class="text-xs sm:text-sm text-gray-500 space-y-2">
                <p>æ•°æ®æ¯30ç§’è‡ªåŠ¨æ›´æ–° Â· æ‰€æœ‰æ•°æ®å…¬å¼€é€æ˜</p>
                <p class="flex items-center justify-center gap-2">
                    <span>Â© 2024 å–µä¹å•†åŸ</span>
                    <span>Â·</span>
                    <a id="shopLink" href="https://shop.maollar.com" target="_blank" rel="noopener noreferrer" class="text-amber-600 hover:text-amber-700 transition" data-i18n="action.visitShop">
                        è®¿é—®å•†åŸ
                    </a>
                </p>
                <div class="flex items-center justify-center gap-2">
                    <label for="langSelect" class="text-gray-500" data-i18n="label.language">è¯­è¨€</label>
                    <select id="langSelect" class="border rounded px-2 py-1 text-gray-700">
                        <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                        <option value="en">English</option>
                        <option value="fr">FranÃ§ais</option>
                        <option value="ja">æ—¥æœ¬èª</option>
                        <option value="ko">í•œêµ­ì–´</option>
                        <option value="es">EspaÃ±ol</option>
                        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                        <option value="th">à¹„à¸—à¸¢</option>
                        <option value="vi">Tiáº¿ng Viá»‡t</option>
                    </select>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // é…ç½®
        const API_BASE_URL = 'https://shop.maollar.com'; // EC2 buyer-api å¤–ç½‘å…¥å£
        const MEOW_TOKEN_ADDRESS = '9zFnwrEyyNPVgahM5NL4MpUH7iy7L8qNCqRprzj39m9N';
        // Cloudflare Worker ä»£ç†åœ°å€ï¼ˆå·²éƒ¨ç½²ï¼‰
        const SOLSCAN_PROXY_URL = 'https://solscan-proxy.mdmoto.workers.dev';
        const DEXSCREENER_API = 'https://api.dexscreener.com/latest/dex/tokens';
        const JUPITER_QUOTE_API = 'https://quote-api.jup.ag/v6/quote';
        const USDC_MINT = 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v'; // Solana USDC
        const MANUAL_FALLBACKS = {
            totalSales: 1536236.43,
            totalSupply: 729529553.75,
            tokenPrice: 0.0094525,
            volume24hText: 'æš‚æ— æ•°æ®'
        };
        // è®¾å¤‡è¯†åˆ«ä¸å•†åŸé“¾æ¥
        function isMobileDevice() {
            const ua = navigator.userAgent || navigator.vendor || window.opera;
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile/i.test(ua);
        }
        function getShopUrl() {
            return isMobileDevice() ? 'https://m.maollar.com' : 'https://shop.maollar.com';
        }
        function setShopLink() {
            const link = document.getElementById('shopLink');
            if (link) link.href = getShopUrl();
        }
        // i18n translations (9 languages)
        const translations = {
            'zh-CN': { title:'å–µä¹å•†åŸå®æ—¶æ•°æ®', subtitle:'å®æ—¶æ›´æ–° Â· æ•°æ®é€æ˜', 'section.stats':'å•†åŸç»Ÿè®¡', 'label.currentTier':'å½“å‰æ¡£ä½', 'label.coinsPerUsd':'æ¯$1è·å¾—', 'label.intrinsicPrice':'å–µå¸ä»·æ ¼', 'label.premium':'å¸‚åœºæº¢ä»·', 'label.totalSales':'æ€»é”€å”®é¢', 'label.fundPool':'åŸºé‡‘æ± æ€»é‡‘é¢', 'section.meow':'å–µå¸ (MEOW)', 'label.tokenAddress':'ä»£å¸åœ°å€', 'label.totalSupply':'æ€»ä¾›åº”é‡', 'label.marketPrice':'äºŒçº§å¸‚åœºä»·æ ¼', 'label.volume24h':'24häº¤æ˜“é‡', 'section.holders':'æŒä»“æ’è¡Œæ¦œ', 'table.rank':'æ’å', 'table.address':'åœ°å€', 'table.amount':'æŒä»“é‡', 'table.share':'å æ¯”', 'section.trades':'æœ€è¿‘äº¤æ˜“', 'table.time':'æ—¶é—´', 'table.type':'ç±»å‹', 'table.qty':'æ•°é‡', 'table.price':'ä»·æ ¼', 'table.txhash':'äº¤æ˜“å“ˆå¸Œ', 'action.refresh':'åˆ·æ–°', 'action.visitShop':'è®¿é—®å•†åŸ', 'label.language':'è¯­è¨€' },
            en: { title:'Maollar Â· Realtime Dashboard', subtitle:'Live updates Â· Transparent data', 'section.stats':'Store Stats', 'label.currentTier':'Current Tier', 'label.coinsPerUsd':'MEOW per $1', 'label.intrinsicPrice':'MEOW Intrinsic Price', 'label.premium':'Market Premium', 'label.totalSales':'Total Sales', 'label.fundPool':'Fund Pool (10%)', 'section.meow':'MEOW Token', 'label.tokenAddress':'Token Address', 'label.totalSupply':'Total Supply', 'label.marketPrice':'Secondary Market Price', 'label.volume24h':'24h Volume', 'section.holders':'Top Holders', 'table.rank':'Rank', 'table.address':'Address', 'table.amount':'Amount', 'table.share':'Share', 'section.trades':'Recent Trades', 'table.time':'Time', 'table.type':'Type', 'table.qty':'Qty', 'table.price':'Price', 'table.txhash':'Tx Hash', 'action.refresh':'Refresh', 'action.visitShop':'Visit Store', 'label.language':'Language' },
            fr: { title:'Maollar Â· DonnÃ©es en temps rÃ©el', subtitle:'Mise Ã  jour en direct Â· DonnÃ©es transparentes', 'section.stats':'Statistiques Boutique', 'label.currentTier':'Palier actuel', 'label.coinsPerUsd':'MEOW par $1', 'label.intrinsicPrice':'Prix intrinsÃ¨que', 'label.premium':'Prime du marchÃ©', 'label.totalSales':'Ventes totales', 'label.fundPool':'Fonds (10%)', 'section.meow':'Jeton MEOW', 'label.tokenAddress':'Adresse du jeton', 'label.totalSupply':'Offre totale', 'label.marketPrice':'Prix du marchÃ© secondaire', 'label.volume24h':'Volume 24h', 'section.holders':'Principaux dÃ©tenteurs', 'table.rank':'Rang', 'table.address':'Adresse', 'table.amount':'QuantitÃ©', 'table.share':'Part', 'section.trades':'Transactions rÃ©centes', 'table.time':'Heure', 'table.type':'Type', 'table.qty':'QtÃ©', 'table.price':'Prix', 'table.txhash':'Hash', 'action.refresh':'RafraÃ®chir', 'action.visitShop':'Visiter la boutique', 'label.language':'Langue' },
            ja: { title:'Maollar Â· ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿', subtitle:'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–° Â· ãƒ‡ãƒ¼ã‚¿ã®é€æ˜æ€§', 'section.stats':'ã‚¹ãƒˆã‚¢çµ±è¨ˆ', 'label.currentTier':'ç¾åœ¨ã®ãƒ†ã‚£ã‚¢', 'label.coinsPerUsd':'$1ã‚ãŸã‚Šã®MEOW', 'label.intrinsicPrice':'MEOW å†…åœ¨ä¾¡å€¤', 'label.premium':'å¸‚å ´ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ', 'label.totalSales':'ç·å£²ä¸Š', 'label.fundPool':'åŸºé‡‘ãƒ—ãƒ¼ãƒ« (10%)', 'section.meow':'MEOW ãƒˆãƒ¼ã‚¯ãƒ³', 'label.tokenAddress':'ãƒˆãƒ¼ã‚¯ãƒ³ã‚¢ãƒ‰ãƒ¬ã‚¹', 'label.totalSupply':'ç·ä¾›çµ¦é‡', 'label.marketPrice':'ã‚»ã‚«ãƒ³ãƒ€ãƒªä¾¡æ ¼', 'label.volume24h':'24æ™‚é–“å‡ºæ¥é«˜', 'section.holders':'ä¸Šä½ä¿æœ‰è€…', 'table.rank':'é †ä½', 'table.address':'ã‚¢ãƒ‰ãƒ¬ã‚¹', 'table.amount':'ä¿æœ‰é‡', 'table.share':'æ¯”ç‡', 'section.trades':'æœ€è¿‘ã®å–å¼•', 'table.time':'æ™‚é–“', 'table.type':'ã‚¿ã‚¤ãƒ—', 'table.qty':'æ•°é‡', 'table.price':'ä¾¡æ ¼', 'table.txhash':'Tx ãƒãƒƒã‚·ãƒ¥', 'action.refresh':'æ›´æ–°', 'action.visitShop':'ã‚¹ãƒˆã‚¢ã¸', 'label.language':'è¨€èª' },
            ko: { title:'Maollar Â· ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ', subtitle:'ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ Â· íˆ¬ëª…í•œ ë°ì´í„°', 'section.stats':'ìŠ¤í† ì–´ í†µê³„', 'label.currentTier':'í˜„ì¬ í‹°ì–´', 'label.coinsPerUsd':'$1 ë‹¹ MEOW', 'label.intrinsicPrice':'MEOW ë‚´ì¬ê°€ì¹˜', 'label.premium':'ì‹œì¥ í”„ë¦¬ë¯¸ì—„', 'label.totalSales':'ì´ ë§¤ì¶œ', 'label.fundPool':'ê¸°ê¸ˆ í’€ (10%)', 'section.meow':'MEOW í† í°', 'label.tokenAddress':'í† í° ì£¼ì†Œ', 'label.totalSupply':'ì´ ê³µê¸‰ëŸ‰', 'label.marketPrice':'2ì°¨ ì‹œì¥ ê°€ê²©', 'label.volume24h':'24ì‹œê°„ ê±°ë˜ëŸ‰', 'section.holders':'ë³´ìœ  ìƒìœ„', 'table.rank':'ìˆœìœ„', 'table.address':'ì£¼ì†Œ', 'table.amount':'ìˆ˜ëŸ‰', 'table.share':'ë¹„ìœ¨', 'section.trades':'ìµœê·¼ ê±°ë˜', 'table.time':'ì‹œê°„', 'table.type':'ìœ í˜•', 'table.qty':'ìˆ˜ëŸ‰', 'table.price':'ê°€ê²©', 'table.txhash':'Tx í•´ì‹œ', 'action.refresh':'ìƒˆë¡œê³ ì¹¨', 'action.visitShop':'ìŠ¤í† ì–´ ë°©ë¬¸', 'label.language':'ì–¸ì–´' },
            es: { title:'Maollar Â· Datos en tiempo real', subtitle:'ActualizaciÃ³n en vivo Â· Datos transparentes', 'section.stats':'EstadÃ­sticas de la tienda', 'label.currentTier':'Nivel actual', 'label.coinsPerUsd':'MEOW por $1', 'label.intrinsicPrice':'Precio intrÃ­nseco', 'label.premium':'Prima de mercado', 'label.totalSales':'Ventas totales', 'label.fundPool':'Fondo (10%)', 'section.meow':'Token MEOW', 'label.tokenAddress':'DirecciÃ³n del token', 'label.totalSupply':'Suministro total', 'label.marketPrice':'Precio secundario', 'label.volume24h':'Volumen 24h', 'section.holders':'Principales holders', 'table.rank':'Rango', 'table.address':'DirecciÃ³n', 'table.amount':'Cantidad', 'table.share':'Porcentaje', 'section.trades':'Operaciones recientes', 'table.time':'Hora', 'table.type':'Tipo', 'table.qty':'Cant.', 'table.price':'Precio', 'table.txhash':'Hash', 'action.refresh':'Actualizar', 'action.visitShop':'Visitar tienda', 'label.language':'Idioma' },
            ar: { title:'Ù…Ø§ÙˆÙ„Ø§Ø± Â· Ù„ÙˆØ­Ø© Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±ÙŠØ©', subtitle:'ØªØ­Ø¯ÙŠØ«Ø§Øª ÙÙˆØ±ÙŠØ© Â· Ø¨ÙŠØ§Ù†Ø§Øª Ø´ÙØ§ÙØ©', 'section.stats':'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªØ¬Ø±', 'label.currentTier':'Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ', 'label.coinsPerUsd':'MEOW Ù„ÙƒÙ„ 1$', 'label.intrinsicPrice':'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠØ©', 'label.premium':'Ø¹Ù„Ø§ÙˆØ© Ø§Ù„Ø³ÙˆÙ‚', 'label.totalSales':'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', 'label.fundPool':'ØµÙ†Ø¯ÙˆÙ‚ (10%)', 'section.meow':'Ø±Ù…Ø² MEOW', 'label.tokenAddress':'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ù…Ø²', 'label.totalSupply':'Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯ Ø§Ù„ÙƒÙ„ÙŠ', 'label.marketPrice':'Ø³Ø¹Ø± Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ', 'label.volume24h':'Ø­Ø¬Ù… 24 Ø³Ø§Ø¹Ø©', 'section.holders':'Ø£ÙƒØ¨Ø± Ø§Ù„Ø­Ø§Ø¦Ø²ÙŠÙ†', 'table.rank':'Ø§Ù„ØªØ±ØªÙŠØ¨', 'table.address':'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', 'table.amount':'Ø§Ù„ÙƒÙ…ÙŠØ©', 'table.share':'Ø§Ù„Ù†Ø³Ø¨Ø©', 'section.trades':'Ø£Ø­Ø¯Ø« Ø§Ù„ØªØ¯Ø§ÙˆÙ„Ø§Øª', 'table.time':'Ø§Ù„ÙˆÙ‚Øª', 'table.type':'Ø§Ù„Ù†ÙˆØ¹', 'table.qty':'Ø§Ù„ÙƒÙ…ÙŠØ©', 'table.price':'Ø§Ù„Ø³Ø¹Ø±', 'table.txhash':'ØªØ¬Ø²Ø¦Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©', 'action.refresh':'ØªØ­Ø¯ÙŠØ«', 'action.visitShop':'Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±', 'label.language':'Ø§Ù„Ù„ØºØ©' },
            th: { title:'Maollar Â· à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸£à¸µà¸¢à¸¥à¹„à¸—à¸¡à¹Œ', subtitle:'à¸­à¸±à¸›à¹€à¸”à¸•à¸ªà¸” Â· à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹‚à¸›à¸£à¹ˆà¸‡à¹ƒà¸ª', 'section.stats':'à¸ªà¸–à¸´à¸•à¸´à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²', 'label.currentTier':'à¸£à¸°à¸”à¸±à¸šà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™', 'label.coinsPerUsd':'MEOW à¸•à¹ˆà¸­ $1', 'label.intrinsicPrice':'à¸£à¸²à¸„à¸²à¸¡à¸¹à¸¥à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¹à¸—à¹‰à¸ˆà¸£à¸´à¸‡', 'label.premium':'à¸à¸£à¸µà¹€à¸¡à¸µà¸¢à¸¡à¸•à¸¥à¸²à¸”', 'label.totalSales':'à¸¢à¸­à¸”à¸‚à¸²à¸¢à¸£à¸§à¸¡', 'label.fundPool':'à¸à¸­à¸‡à¸—à¸¸à¸™ (10%)', 'section.meow':'à¹‚à¸—à¹€à¸„à¸™ MEOW', 'label.tokenAddress':'à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¹‚à¸—à¹€à¸„à¸™', 'label.totalSupply':'à¸­à¸¸à¸›à¸—à¸²à¸™à¸£à¸§à¸¡', 'label.marketPrice':'à¸£à¸²à¸„à¸²à¸£à¸­à¸‡', 'label.volume24h':'à¸›à¸£à¸´à¸¡à¸²à¸“ 24à¸Šà¸¡.', 'section.holders':'à¸œà¸¹à¹‰à¸–à¸·à¸­à¸­à¸±à¸™à¸”à¸±à¸šà¸•à¹‰à¸™', 'table.rank':'à¸­à¸±à¸™à¸”à¸±à¸š', 'table.address':'à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆ', 'table.amount':'à¸ˆà¸³à¸™à¸§à¸™', 'table.share':'à¸ªà¸±à¸”à¸ªà¹ˆà¸§à¸™', 'section.trades':'à¸£à¸²à¸¢à¸à¸²à¸£à¸¥à¹ˆà¸²à¸ªà¸¸à¸”', 'table.time':'à¹€à¸§à¸¥à¸²', 'table.type':'à¸›à¸£à¸°à¹€à¸ à¸—', 'table.qty':'à¸ˆà¸³à¸™à¸§à¸™', 'table.price':'à¸£à¸²à¸„à¸²', 'table.txhash':'à¹à¸®à¸Š', 'action.refresh':'à¸£à¸µà¹€à¸Ÿà¸£à¸Š', 'action.visitShop':'à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¹‰à¸²à¸™', 'label.language':'à¸ à¸²à¸©à¸²' },
            vi: { title:'Maollar Â· Dá»¯ liá»‡u thá»i gian thá»±c', subtitle:'Cáº­p nháº­t trá»±c tiáº¿p Â· Dá»¯ liá»‡u minh báº¡ch', 'section.stats':'Thá»‘ng kÃª cá»­a hÃ ng', 'label.currentTier':'Báº­c hiá»‡n táº¡i', 'label.coinsPerUsd':'MEOW trÃªn $1', 'label.intrinsicPrice':'GiÃ¡ ná»™i táº¡i', 'label.premium':'Phá»¥ trá»™i thá»‹ trÆ°á»ng', 'label.totalSales':'Tá»•ng doanh sá»‘', 'label.fundPool':'Quá»¹ (10%)', 'section.meow':'Token MEOW', 'label.tokenAddress':'Äá»‹a chá»‰ token', 'label.totalSupply':'Tá»•ng cung', 'label.marketPrice':'GiÃ¡ thá»‹ trÆ°á»ng thá»© cáº¥p', 'label.volume24h':'Khá»‘i lÆ°á»£ng 24h', 'section.holders':'Top náº¯m giá»¯', 'table.rank':'Háº¡ng', 'table.address':'Äá»‹a chá»‰', 'table.amount':'Sá»‘ lÆ°á»£ng', 'table.share':'Tá»· lá»‡', 'section.trades':'Giao dá»‹ch gáº§n Ä‘Ã¢y', 'table.time':'Thá»i gian', 'table.type':'Loáº¡i', 'table.qty':'SL', 'table.price':'GiÃ¡', 'table.txhash':'Tx Hash', 'action.refresh':'LÃ m má»›i', 'action.visitShop':'VÃ o cá»­a hÃ ng', 'label.language':'NgÃ´n ngá»¯' },
        };

        function detectLanguage() {
            const saved = localStorage.getItem('fund.lang');
            if (saved && translations[saved]) return saved;
            const sys = (navigator.language || 'zh-CN').toLowerCase();
            const map = { 'zh':'zh-CN','zh-cn':'zh-CN','en':'en','fr':'fr','ja':'ja','ko':'ko','es':'es','ar':'ar','th':'th','vi':'vi' };
            return map[sys] || map[sys.split('-')[0]] || 'zh-CN';
        }

        function applyI18n(lang) {
            const dict = translations[lang] || translations['zh-CN'];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (dict[key]) el.textContent = dict[key];
            });
            const select = document.getElementById('langSelect');
            if (select) select.value = lang;
            localStorage.setItem('fund.lang', lang);
        }

        const TEN_WAN_USD = 100000;
        const DISPLAY_CURRENCY_SYMBOL = '$';
        const tierSnapshot = {
            level: 7,
            salesUnit: 21.0,
            fundUnit: 2.1,
            coinsPerDollar: 125,
            tierCoinTotal: 1000,
            cumulativeCoinTotal: 8000,
            intrinsicPrice: 0.0002625
        };
        let latestSecondaryPriceUsd = null;
        // å­˜å‚¨ç”¨äºè®¡ç®—å†…åœ¨ä»·æ ¼çš„æ•°æ®
        let currentFundPoolUsd = null;
        let currentTotalSupply = null;

        // æ ¼å¼åŒ–æ•°å­—
        function formatNumber(num) {
            if (num === null || num === undefined) return 'N/A';
            if (num >= 1000000000) {
                return (num / 1000000000).toFixed(2) + 'B';
            } else if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(2) + 'K';
            }
            return num.toLocaleString('zh-CN', { maximumFractionDigits: 2 });
        }

        // æ ¼å¼åŒ–ä»£å¸æ•°é‡
        function formatTokenAmount(amount, decimals = 9) {
            if (!amount) return '0';
            const num = typeof amount === 'string' ? parseFloat(amount) : amount;
            if (num === 0) return '0';
            if (num < 0.01) return num.toExponential(2);
            return num.toLocaleString('zh-CN', { 
                maximumFractionDigits: decimals 
            });
        }

        // æ ¼å¼åŒ–ç¾å…ƒé‡‘é¢
        function formatUSD(value, precision = 4) {
            if (value === null || value === undefined || isNaN(value)) {
                return '$0.00';
            }
            const num = Number(value);
            if (num >= 1) {
                return '$' + num.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            }
            return '$' + num.toFixed(precision);
        }

        function formatLargeCurrency(amount) {
            if (amount === null || amount === undefined || isNaN(amount)) return `${DISPLAY_CURRENCY_SYMBOL}0`;
            if (amount >= 1e9) return DISPLAY_CURRENCY_SYMBOL + (amount / 1e9).toFixed(2) + 'B';
            if (amount >= 1e6) return DISPLAY_CURRENCY_SYMBOL + (amount / 1e6).toFixed(2) + 'M';
            if (amount >= 1e3) return DISPLAY_CURRENCY_SYMBOL + amount.toLocaleString('en-US', { maximumFractionDigits: 0 });
            return DISPLAY_CURRENCY_SYMBOL + amount.toFixed(2);
        }

        function buildProxyUrl(service, path, params = {}) {
            const proxyUrl = new URL(SOLSCAN_PROXY_URL);
            proxyUrl.searchParams.set('service', service);
            proxyUrl.searchParams.set('path', path);
            Object.entries(params || {}).forEach(([key, value]) => {
                if (value !== undefined && value !== null) {
                    proxyUrl.searchParams.set(key, value);
                }
            });
            return proxyUrl.toString();
        }

        const buildSolscanProxyUrl = (path, params) => buildProxyUrl('solscan', path, params);

        // æ„å»º Solscan ä»£ç† URL
        async function fetchJson(url, options = {}) {
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    ...(options.headers || {})
                },
                ...options
            });

            const rawText = await response.text();

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText || ''} ${rawText.slice(0, 80)}`);
            }

            if (!rawText) {
                return {};
            }

            try {
                return JSON.parse(rawText);
            } catch (error) {
                throw new Error(`JSON è§£æå¤±è´¥: ${error.message}`);
            }
        }

        // è®¡ç®—å¹¶æ›´æ–°å–µå¸ä»·æ ¼ï¼ˆåŸºé‡‘æ± æ€»é‡‘é¢ / æ€»ä¾›åº”é‡ï¼‰
        function updateIntrinsicPrice() {
            const intrinsicPriceNode = document.getElementById('intrinsicPrice');
            if (!intrinsicPriceNode) return;

            // ä½¿ç”¨å…¨å±€å˜é‡ä¸­çš„æ•°æ®
            const fundPoolUsd = currentFundPoolUsd;
            const totalSupply = currentTotalSupply;

            // å¦‚æœå…¨å±€å˜é‡ä¸ºç©ºï¼Œå°è¯•ä½¿ç”¨æ‰‹åŠ¨å›é€€å€¼
            const finalFundPool = fundPoolUsd !== null ? fundPoolUsd : (MANUAL_FALLBACKS.totalSales * 0.1);
            const finalTotalSupply = totalSupply !== null ? totalSupply : MANUAL_FALLBACKS.totalSupply;

            // è®¡ç®—å†…åœ¨ä»·æ ¼
            if (finalFundPool && finalTotalSupply && finalTotalSupply > 0) {
                const intrinsicPrice = finalFundPool / finalTotalSupply;
                intrinsicPriceNode.textContent = formatUSD(intrinsicPrice, 6);
                // æ›´æ–° tierSnapshot.intrinsicPrice ä»¥ä¾¿æº¢ä»·è®¡ç®—ä½¿ç”¨
                tierSnapshot.intrinsicPrice = intrinsicPrice;
                // å¦‚æœå·²æœ‰äºŒçº§å¸‚åœºä»·æ ¼ï¼Œæ›´æ–°æº¢ä»·æ˜¾ç¤º
                if (latestSecondaryPriceUsd) {
                    updateSecondaryPremiumDisplay();
                }
            } else {
                intrinsicPriceNode.textContent = 'è®¡ç®—ä¸­...';
            }
        }

        function renderTierSnapshot() {
            const tierLabel = `ç¬¬${tierSnapshot.level}æ¡£`;
            const totalSalesUsd = tierSnapshot.salesUnit * TEN_WAN_USD;
            const fundPoolUsd = tierSnapshot.fundUnit * TEN_WAN_USD;

            const coinsPerUsd = Number(tierSnapshot.coinsPerDollar || 0).toLocaleString('en-US', {
                maximumFractionDigits: 6
            });

            document.getElementById('currentTier').textContent = tierLabel;
            document.getElementById('coinsPerUsd').textContent = `${coinsPerUsd} æš`;
            // ä¸å†ç›´æ¥è®¾ç½®å†…åœ¨ä»·æ ¼ï¼Œè€Œæ˜¯é€šè¿‡è®¡ç®—å‡½æ•°æ›´æ–°
            document.getElementById('intrinsicPrice').textContent = 'è®¡ç®—ä¸­...';
            document.getElementById('secondaryPremium').textContent = 'è®¡ç®—ä¸­...';
        }

        function updateSecondaryPremiumDisplay() {
            const premiumNode = document.getElementById('secondaryPremium');
            if (!premiumNode) return;
            if (!latestSecondaryPriceUsd || !tierSnapshot.intrinsicPrice || tierSnapshot.intrinsicPrice <= 0) {
                premiumNode.textContent = 'æš‚æ— æ•°æ®';
                return;
            }
            const premium = (latestSecondaryPriceUsd / tierSnapshot.intrinsicPrice) * 100;
            premiumNode.textContent = isFinite(premium) ? premium.toFixed(2) + '%' : 'æš‚æ— æ•°æ®';
        }

        async function fetchJupiterPrice() {
            try {
                const params = new URLSearchParams({
                    inputMint: USDC_MINT,
                    outputMint: MEOW_TOKEN_ADDRESS,
                    amount: '1000000',
                    slippageBps: '50',
                    onlyDirectRoutes: 'true'
                });
                const url = `${JUPITER_QUOTE_API}?${params.toString()}`;
                const quote = await fetchJson(url);
                const route = quote?.data?.[0];
                if (!route) return null;

                const outAmount = Number(route.outAmount || 0);
                const outDecimals = route.outputMintDecimals ?? 9;
                if (!outAmount) return null;

                const tokensPerUsd = outAmount / Math.pow(10, outDecimals);
                const priceUsd = tokensPerUsd > 0 ? 1 / tokensPerUsd : null;
                return {
                    priceUsd,
                    route
                };
            } catch (error) {
                console.warn('Jupiter quote failed:', error);
                return null;
            }
        }

        // é“¾ä¸Šæ•°æ®ï¼ˆSolscan via Workerï¼‰
        async function loadTokenInfo() {
            try {
                const metaUrl = buildSolscanProxyUrl('/v2/token/meta', { address: MEOW_TOKEN_ADDRESS });
                const metaPayload = await fetchJson(metaUrl);
                const tokenMeta = metaPayload?.data || metaPayload || {};
                const metaInfo = tokenMeta.tokenInfo || tokenMeta || {};

                if (metaInfo && metaInfo.supply !== undefined) {
                    const supplyRaw = metaInfo.supply ?? metaInfo.tokenAuthorityData?.supply ?? 0;
                    const decimals = metaInfo.decimals ?? 9;
                    const totalSupply = supplyRaw / Math.pow(10, decimals);
                    // å­˜å‚¨åˆ°å…¨å±€å˜é‡
                    currentTotalSupply = totalSupply;
                    document.getElementById('totalSupply').textContent = formatTokenAmount(totalSupply, 2) + ' MEOW';
                } else {
                    document.getElementById('totalSupply').textContent = 'æš‚æ— ä¾›åº”æ•°æ®';
                }

                await Promise.all([
                    loadTokenHolders(),
                    loadRecentTransactions()
                ]);
            } catch (error) {
                console.error('åŠ è½½é“¾ä¸Šä»£å¸ä¿¡æ¯å¤±è´¥:', error);
                if (MANUAL_FALLBACKS.totalSupply !== undefined) {
                    // å­˜å‚¨åˆ°å…¨å±€å˜é‡
                    currentTotalSupply = MANUAL_FALLBACKS.totalSupply;
                    document.getElementById('totalSupply').textContent =
                        formatTokenAmount(MANUAL_FALLBACKS.totalSupply, 2) + ' MEOW';
                } else {
                    currentTotalSupply = null;
                }
                showOnChainUnavailable('é“¾ä¸Šæ•°æ®è·å–å¤±è´¥', { skipSupply: MANUAL_FALLBACKS.totalSupply !== undefined });
            }
            // æ•°æ®åŠ è½½å®Œæˆåæ›´æ–°å†…åœ¨ä»·æ ¼
            updateIntrinsicPrice();
        }

        async function loadTokenHolders() {
            try {
                const url = buildSolscanProxyUrl('/v2/token/holders', {
                    address: MEOW_TOKEN_ADDRESS,
                    limit: 10,
                    offset: 0
                });
                const data = await fetchJson(url);
                const holders = data?.data?.items || data?.data || data?.result || [];

                if (!Array.isArray(holders) || holders.length === 0) {
                    showHoldersPlaceholder('æš‚æ— æŒä»“æ•°æ®');
                    return;
                }

                const tbody = document.getElementById('holdersTable');
                tbody.innerHTML = '';
                let totalAmount = 0;
                holders.forEach(item => {
                    totalAmount += Number(item.amount || item.tokenAmount || 0);
                });

                holders.forEach((item, index) => {
                    const amount = Number(item.amount || item.tokenAmount || 0);
                    const percentage = totalAmount > 0 ? (amount / totalAmount * 100).toFixed(2) : '0.00';
                    const address = item.owner || item.address || '';
                    const shortAddress = address.length > 10
                        ? `${address.slice(0, 4)}...${address.slice(-4)}`
                        : address;

                    const tr = document.createElement('tr');
                    tr.className = 'hover:bg-gray-50 transition';
                    tr.innerHTML = `
                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-gray-700">${index + 1}</td>
                        <td class="px-2 sm:px-4 py-2 sm:py-3">
                            <a href="https://solscan.io/account/${address}" target="_blank" rel="noopener noreferrer"
                               class="text-blue-600 hover:underline font-mono text-xs sm:text-sm">
                                ${shortAddress}
                            </a>
                        </td>
                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-right font-mono text-xs sm:text-sm">
                            ${formatTokenAmount(amount, 2)}
                        </td>
                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-right text-xs sm:text-sm">
                            ${percentage}%
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('åŠ è½½æŒä»“æ’è¡Œæ¦œå¤±è´¥:', error);
                showHoldersPlaceholder(`åŠ è½½å¤±è´¥ï¼š${error.message}`);
            }
        }

        async function loadRecentTransactions() {
            try {
                const url = buildSolscanProxyUrl('/v2/token/transactions', {
                    address: MEOW_TOKEN_ADDRESS,
                    limit: 10
                });
                const data = await fetchJson(url);
                const records = data?.data?.items || data?.data || data?.result || [];

                if (!Array.isArray(records) || records.length === 0) {
                    showTransactionsPlaceholder('æš‚æ—¶æ²¡æœ‰äº¤æ˜“è®°å½•');
                    return;
                }

                const tbody = document.getElementById('transactionsTable');
                tbody.innerHTML = '';
                records.forEach(item => {
                    const blockTime = item.blockTime || item.block_time || 0;
                    const timeText = blockTime
                        ? new Date(blockTime * 1000).toLocaleString('zh-CN')
                        : 'æœªçŸ¥æ—¶é—´';
                    const type = item.type || 'æœªçŸ¥';
                    const amount = formatTokenAmount(item.changeAmount || item.amount || 0, 2);
                    const price = item.price ? formatUSD(item.price) : 'N/A';
                    const signature = item.signature || '';
                    const shortSig = signature.length > 16
                        ? `${signature.slice(0, 8)}...${signature.slice(-6)}`
                        : signature;

                    const tr = document.createElement('tr');
                    tr.className = 'hover:bg-gray-50 transition';
                    tr.innerHTML = `
                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm text-gray-700">${timeText}</td>
                        <td class="px-2 sm:px-4 py-2 sm:py-3">
                            <span class="inline-block px-2 py-1 rounded-md text-xs font-semibold ${
                                type.toLowerCase().includes('buy') || type.includes('ä¹°')
                                    ? 'bg-green-100 text-green-700'
                                    : 'bg-red-100 text-red-700'
                            }">
                                ${type}
                            </span>
                        </td>
                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-right font-mono text-xs sm:text-sm">${amount}</td>
                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-right text-xs sm:text-sm font-semibold">${price}</td>
                        <td class="px-2 sm:px-4 py-2 sm:py-3 hidden sm:table-cell">
                            <a href="https://solscan.io/tx/${signature}" target="_blank" rel="noopener noreferrer"
                               class="text-blue-600 hover:text-blue-800 hover:underline font-mono text-xs transition">
                                ${shortSig}
                            </a>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('åŠ è½½é“¾ä¸Šäº¤æ˜“å¤±è´¥:', error);
                showTransactionsPlaceholder(`åŠ è½½å¤±è´¥ï¼š${error.message}`);
            }
        }

        // åŠ è½½å–µå¸ä»·æ ¼ä¸æˆäº¤é‡ï¼ˆä¼˜å…ˆ Jupiterï¼Œå¤±è´¥å†å°è¯• Dexscreenerï¼‰
        async function loadTokenMarketData() {
            let priceUpdated = false;
            try {
                const jupiterData = await fetchJupiterPrice();
                if (jupiterData?.priceUsd) {
                    document.getElementById('tokenPrice').textContent = formatUSD(jupiterData.priceUsd, 6);
                    latestSecondaryPriceUsd = jupiterData.priceUsd;
                    updateSecondaryPremiumDisplay();
                    document.getElementById('volume24h').textContent = 'Jupiter è·¯å¾„';
                    priceUpdated = true;
                }
            } catch (error) {
                console.warn('Jupiter quote error:', error);
            }

            if (priceUpdated) return;

            try {
                const url = `${DEXSCREENER_API}/${MEOW_TOKEN_ADDRESS}`;
                console.log('Fetching Dexscreener data from:', url);
                
                const data = await fetchJson(url);
                console.log('Dexscreener response:', data);

                if (data && Array.isArray(data.pairs) && data.pairs.length > 0) {
                    const sortedPairs = data.pairs.sort((a, b) => {
                        const liqA = a.liquidity?.usd || 0;
                        const liqB = b.liquidity?.usd || 0;
                        return liqB - liqA;
                    });
                    const topPair = sortedPairs[0] || {};
                    const priceUsd = Number(topPair.priceUsd || 0);
                    const volumeUsd = topPair.volume?.h24 || 0;

                    document.getElementById('tokenPrice').textContent = priceUsd
                        ? formatUSD(priceUsd, 6)
                        : 'æš‚æ— ä»·æ ¼';
                    latestSecondaryPriceUsd = priceUsd || null;
                    updateSecondaryPremiumDisplay();

                    document.getElementById('volume24h').textContent = volumeUsd
                        ? formatUSD(volumeUsd, 2)
                        : 'æš‚æ— æ•°æ®';
                    return;
                }
            } catch (error) {
                console.error('åŠ è½½ Dexscreener æ•°æ®å¤±è´¥:', error);
            }

            if (MANUAL_FALLBACKS.tokenPrice !== undefined) {
                document.getElementById('tokenPrice').textContent = formatUSD(MANUAL_FALLBACKS.tokenPrice, 6);
                latestSecondaryPriceUsd = MANUAL_FALLBACKS.tokenPrice;
                updateSecondaryPremiumDisplay();
            } else {
                document.getElementById('tokenPrice').textContent = 'æš‚æ— ä»·æ ¼';
                latestSecondaryPriceUsd = null;
                updateSecondaryPremiumDisplay();
            }
            document.getElementById('volume24h').textContent = MANUAL_FALLBACKS.volume24hText || 'æš‚æ— æ•°æ®';
        }

        async function loadShopStatistics() {
            try {
                const response = await fetch(`${API_BASE_URL}/buyer/statistics/realtime`);
                const result = await response.json();

                if (result.result && result.data) {
                    const totalSales = Number(result.data.totalSalesAmount || 0);
                    const fundPool = totalSales * 0.1;
                    // å­˜å‚¨åˆ°å…¨å±€å˜é‡
                    currentFundPoolUsd = fundPool;
                    document.getElementById('totalSalesValue').textContent = formatLargeCurrency(totalSales);
                    document.getElementById('fundPoolValue').textContent = formatLargeCurrency(fundPool);
                } else {
                    throw new Error('invalid payload');
                }
            } catch (error) {
                console.error('åŠ è½½å®æ—¶é”€å”®æ•°æ®å¤±è´¥:', error);
                if (MANUAL_FALLBACKS.totalSales !== undefined) {
                    const fundPool = MANUAL_FALLBACKS.totalSales * 0.1;
                    // å­˜å‚¨åˆ°å…¨å±€å˜é‡
                    currentFundPoolUsd = fundPool;
                    document.getElementById('totalSalesValue').textContent = formatLargeCurrency(MANUAL_FALLBACKS.totalSales);
                    document.getElementById('fundPoolValue').textContent = formatLargeCurrency(fundPool);
                } else {
                    currentFundPoolUsd = null;
                    document.getElementById('totalSalesValue').textContent = 'åŠ è½½å¤±è´¥';
                    document.getElementById('fundPoolValue').textContent = 'åŠ è½½å¤±è´¥';
                }
            }
            // æ•°æ®åŠ è½½å®Œæˆåæ›´æ–°å†…åœ¨ä»·æ ¼
            updateIntrinsicPrice();
        }

        function showHoldersPlaceholder(message) {
            const holdersTable = document.getElementById('holdersTable');
            if (!holdersTable) return;
            holdersTable.innerHTML = `
                <tr>
                    <td colspan="4" class="px-4 py-8 text-center text-gray-500">
                        ${message}
                    </td>
                </tr>
            `;
        }

        function showTransactionsPlaceholder(message) {
            document.getElementById('transactionsTable').innerHTML = `
                <tr>
                    <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                        ${message}
                    </td>
                </tr>
            `;
        }

        function showOnChainUnavailable(message = 'é“¾ä¸Šæ•°æ®æš‚ä¸å¯ç”¨', options = {}) {
            const { skipSupply = false } = options;
            if (!skipSupply) {
                document.getElementById('totalSupply').textContent = message;
            }
            showHoldersPlaceholder(message);
            showTransactionsPlaceholder(message);
        }

        // åŠ è½½æ‰€æœ‰æ•°æ®
        function applyManualFallbacks() {
            if (MANUAL_FALLBACKS.totalSupply !== undefined) {
                // åˆå§‹åŒ–å…¨å±€å˜é‡
                currentTotalSupply = MANUAL_FALLBACKS.totalSupply;
                document.getElementById('totalSupply').textContent =
                    formatTokenAmount(MANUAL_FALLBACKS.totalSupply, 2) + ' MEOW';
            }
            if (MANUAL_FALLBACKS.tokenPrice !== undefined) {
                document.getElementById('tokenPrice').textContent = formatUSD(MANUAL_FALLBACKS.tokenPrice, 6);
            }
            if (MANUAL_FALLBACKS.volume24hText) {
                document.getElementById('volume24h').textContent = MANUAL_FALLBACKS.volume24hText;
            }
            if (MANUAL_FALLBACKS.totalSales !== undefined) {
                // åˆå§‹åŒ–å…¨å±€å˜é‡
                currentFundPoolUsd = MANUAL_FALLBACKS.totalSales * 0.1;
                document.getElementById('totalSalesValue').textContent = formatLargeCurrency(MANUAL_FALLBACKS.totalSales);
                document.getElementById('fundPoolValue').textContent = formatLargeCurrency(MANUAL_FALLBACKS.totalSales * 0.1);
            }
            // åº”ç”¨æ‰‹åŠ¨å›é€€å€¼åï¼Œå°è¯•è®¡ç®—å†…åœ¨ä»·æ ¼
            updateIntrinsicPrice();
        }

        async function loadAllData() {
            renderTierSnapshot();
            applyManualFallbacks();
            setShopLink();
            // i18n init
            const lang = detectLanguage();
            applyI18n(lang);
            const sel = document.getElementById('langSelect');
            if (sel) {
                sel.addEventListener('change', (e) => {
                    applyI18n(e.target.value);
                });
            }
            await Promise.all([
                loadShopStatistics(),
                loadTokenMarketData(),
                loadTokenInfo()
            ]);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½æ•°æ®
        loadAllData();

        // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
        setInterval(loadAllData, 30000);
    </script>
</body>
</html>

